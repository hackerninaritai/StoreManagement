<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Item</title>
<script src="../asset/jquery-3.5.1.min.js"></script>
<script src="../asset/bootstrap/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css"
	href="../asset/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://use.fontawesome.com/releases/v5.15.1/css/all.css"
	integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp"
	crossorigin="anonymous">

<script>
	$(document).ready(function() {
		$.ajax({
			url : '/api/item',
			error : function(e) {
				$('#info').html('<p>An error has occurred</p>');
				console.log(e)
			},
			success : function(data) {
				data.forEach(element => {
					$('#itemTableBody').append('<tr id='+'"'+element.itemId +'"'+'>'+
							'<td>'+element.itemId+'</td>'+
							'<td>'+element.itemName+'</td>'+
							'<td>'+element.itemPurchasePrice+'</td>'+
							'<td>'+element.itemSellingPrice+'</td>'+
							'<td>'+element.itemInstock+'</td>'+
							'<td>'
							+'<i class="fas fa-edit"></i>'+ " "+
							'<i class="fas fa-trash-alt"></i>'+
							'</td>'+
					'</tr>');
				})
			},
			type : 'GET'
		});
	});
</script>

</head>
<body>

	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">DELETE</h5>
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">Do you want to delete this?</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-dismiss="modal">NO</button>
					<a href="#delete"><button type="button" class="btn btn-primary">YES</button></a>
				</div>
			</div>
		</div>
	</div>
	<div id="info"></div>
	<div class="container-xl">
		<div class="table-responsive">
			<div class="table-wrapper">
				<div class="table-title">
					<div class="row">
						<div class="col-sm-6">
							<h2>
								Manage <b>Item</b>
							</h2>
						</div>
						<div class="col-sm-6">
							<a href="#itemModal" class="btn btn-success" data-toggle="modal"><i
								class="material-icons">&#xE147;</i> <span>Add New Item</span></a> <a
								href="#deleteEmployeeModal" class="btn btn-danger"
								data-toggle="modal"><i class="material-icons">&#xE15C;</i> <span>Delete</span></a>
						</div>
					</div>
				</div>
				<table class="table">
					<thead class="thead-dark">
						<tr>
							<th scope="col">id</th>
							<th scope="col">Item name</th>
							<th scope="col">Purchase price</th>
							<th scope="col">Selling price</th>
							<th scope="col">In stock</th>
							<th scope="col">Action</th>
						</tr>
					</thead>
					<tbody id="itemTableBody">
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div id="itemModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">
						<h4 class="modal-title">Item</h4>
						<button type="button" class="close" data-dismiss="modal"
							aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label>Item name</label> <input type="text" name="itemName"
								class="form-control" required>
						</div>
						<div class="form-group">
							<label>Purchase price</label> <input type="text"
								name="itemPurchasePrice" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Selling price</label> <input type="text"
								name="itemSellingPrice" class="form-control" required>
						</div>
						<div class="form-group">
							<label>in stock</label> <input type="text" name="itemInstock"
								class="form-control" required>
						</div>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal"
							value="Cancel"> <input type="submit"
							class="btn btn-success" value="Add">
					</div>
				</form>
			</div>
		</div>
	</div>
	<script>
	$(document).on('click', '.fa-edit', function(){ 
		$.ajax({
			url : '/api/item?itemId=' +this.parentElement.parentElement.id,
			error : function(e) {
				$('#info').html('<p>An error has occurred</p>');
				console.log(e)
			},
			success : function(data) {
				console.log(data)
			},
			type : 'GET'
		});
		$.ajax({
			  url: '_itemForm.html',
			  dataType: 'text',
			  success: function(data) {
			    alert(data);
			  }
			});
	}); 
	$(document).on('click', '.fa-trash-alt', function(){ 
		$('#exampleModal').modal('show');
	}); 

	$( "#itemModal" ).submit(function( event ) {
		  event.preventDefault();
		  var form = document.querySelector('form');
		  var formData = new FormData(form);
		  var myData = JSON.stringify(Object.fromEntries(formData))
		  $.ajax({
				url : '/api/item/save',
				data: myData,
				contentType: "application/json",
				error : function(e) {
					$('#info').html('<p>An error has occurred</p>');

					alert("error")
				},
				success : function(data) {
					console.log(myData)
				},
				type : 'POST'
			});
		});
	
	
	$("#action").click(function() {
		  console.log( "Handler for .click() called." );
		});
	</script>
</body>
</html>